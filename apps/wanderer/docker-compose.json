{
  "schemaVersion": 2,
  "services": [
    {
      "name": "web",
      "image": "flomp/wanderer-web:v0.18.3",
      "isMain": true,
      "environment": [
        {
          "key": "MEILI_URL",
          "value": "http://search:7700"
        },
        {
          "key": "MEILI_MASTER_KEY",
          "value": "${MEILI_MASTER_KEY}"
        },
        {
          "key": "ORIGIN",
          "value": "https://${APP_DOMAIN:-localhost}"
        },
        {
          "key": "BODY_SIZE_LIMIT",
          "value": "Infinity"
        },
        {
          "key": "PUBLIC_POCKETBASE_URL",
          "value": "http://db:8090"
        },
        {
          "key": "PUBLIC_DISABLE_SIGNUP",
          "value": "false"
        },
        {
          "key": "UPLOAD_FOLDER",
          "value": "/app/uploads"
        },
        {
          "key": "PUBLIC_VALHALLA_URL",
          "value": "https://valhalla1.openstreetmap.de"
        },
        {
          "key": "PUBLIC_NOMINATIM_URL",
          "value": "https://nominatim.openstreetmap.org"
        }
      ],
      "internalPort": 3000,
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/uploads",
          "containerPath": "/app/uploads",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "dependsOn": {
        "search": {
          "condition": "service_healthy"
        },
        "db": {
          "condition": "service_started"
        }
      }
    },
    {
      "name": "search",
      "image": "getmeili/meilisearch:v1.11.3",
      "environment": [
        {
          "key": "MEILI_URL",
          "value": "http://search:7700"
        },
        {
          "key": "MEILI_MASTER_KEY",
          "value": "${MEILI_MASTER_KEY}"
        },
        {
          "key": "MEILI_NO_ANALYTICS",
          "value": "true"
        }
      ],
      "internalPort": 7700,
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/data.ms",
          "containerPath": "/meili_data/data.ms",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "healthCheck": {
        "test": "curl --fail http://localhost:7700/health || exit 1",
        "interval": "15s",
        "timeout": "10s",
        "retries": 10,
        "start_period": "20s"
      }
    },
    {
      "name": "db",
      "image": "flomp/wanderer-db:v0.18.3",
      "environment": [
        {
          "key": "MEILI_URL",
          "value": "http://search:7700"
        },
        {
          "key": "MEILI_MASTER_KEY",
          "value": "${MEILI_MASTER_KEY}"
        },
        {
          "key": "POCKETBASE_ENCRYPTION_KEY",
          "value": "${POCKETBASE_ENCRYPTION_KEY}"
        },
        {
          "key": "ORIGIN",
          "value": "https://${APP_DOMAIN:-localhost}"
        }
      ],
      "internalPort": 8090,
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/pb_data",
          "containerPath": "/pb_data",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "dependsOn": {
        "search": {
          "condition": "service_healthy"
        }
      }
    }
  ]
}
