{
  "schemaVersion": 2,
  "services": [
    {
      "name": "server",
      "image": "msdeluise/plant-it-server:0.10.0",
      "isMain": true,
      "internalPort": "3000",
      "addPorts": [
        {
          "hostPort": 38080,
          "containerPort": 8080
        }
      ],
      "environment": [
        {
          "key": "MYSQL_HOST",
          "value": "db"
        },
        {
          "key": "MYSQL_PORT",
          "value": "3306"
        },
        {
          "key": "MYSQL_USERNAME",
          "value": "root"
        },
        {
          "key": "MYSQL_PSW",
          "value": "root"
        },
        {
          "key": "MYSQL_DATABASE",
          "value": "bootdb"
        },
        {
          "key": "MYSQL_ROOT_PASSWORD",
          "value": "root"
        },
        {
          "key": "JWT_EXP",
          "value": "1"
        },
        {
          "key": "UPLOAD_DIR",
          "value": "/upload-dir"
        },
        {
          "key": "API_PORT",
          "value": "8080"
        },
        {
          "key": "LOG_LEVEL",
          "value": "WARN"
        },
        {
          "key": "GOTIFY_ENABLED",
          "value": "true"
        },
        {
          "key": "FLORACODEX_KEY",
          "value": "${FLORACODEX_KEY}"
        },
        {
          "key": "JWT_SECRET",
          "value": "${JWT_SECRET}"
        },
        {
          "key": "USERS_LIMIT",
          "value": "${USERS_LIMIT}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/upload-dir",
          "containerPath": "/upload-dir"
        }
      ],
      "extraLabels": {
        "traefik.http.middlewares.{{RUNTIPI_APP_ID}}-api-web-redirect.redirectscheme.scheme": "https",
        "traefik.http.services.{{RUNTIPI_APP_ID}}-api.loadbalancer.server.port": "8080",
        "traefik.http.routers.{{RUNTIPI_APP_ID}}-api.rule": "Host(`${API_DOMAIN}`)",
        "traefik.http.routers.{{RUNTIPI_APP_ID}}-api.entrypoints": "websecure",
        "traefik.http.routers.{{RUNTIPI_APP_ID}}-api.service": "{{RUNTIPI_APP_ID}}-api",
        "traefik.http.routers.{{RUNTIPI_APP_ID}}-api.tls.certresolver": "myresolver"
      },
      "dependsOn": ["db", "cache"]
    },
    {
      "name": "db",
      "image": "mysql:8.0",
      "isMain": false,
      "environment": [
        {
          "key": "MYSQL_HOST",
          "value": "db"
        },
        {
          "key": "MYSQL_PORT",
          "value": "3306"
        },
        {
          "key": "MYSQL_USERNAME",
          "value": "root"
        },
        {
          "key": "MYSQL_PSW",
          "value": "root"
        },
        {
          "key": "MYSQL_DATABASE",
          "value": "bootdb"
        },
        {
          "key": "MYSQL_ROOT_PASSWORD",
          "value": "root"
        },
        {
          "key": "JWT_EXP",
          "value": "1"
        },
        {
          "key": "UPLOAD_DIR",
          "value": "/upload-dir"
        },
        {
          "key": "API_PORT",
          "value": "8080"
        },
        {
          "key": "LOG_LEVEL",
          "value": "WARN"
        },
        {
          "key": "GOTIFY_ENABLED",
          "value": "true"
        },
        {
          "key": "FLORACODEX_KEY",
          "value": "${FLORACODEX_KEY}"
        },
        {
          "key": "JWT_SECRET",
          "value": "${JWT_SECRET}"
        },
        {
          "key": "USERS_LIMIT",
          "value": "${USERS_LIMIT}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/db",
          "containerPath": "/var/lib/mysql"
        }
      ]
    },
    {
      "name": "cache",
      "image": "redis:7.2.1",
      "isMain": false
    }
  ]
}
